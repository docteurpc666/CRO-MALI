<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Ajouter un Produit</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    /* Reset minimal */
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f0f2f5;
      margin: 0;
      padding: 0;
      color: #333;
    }

    /* === NAVBAR === */
    nav {
      background: #007bff;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 20px;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    nav .logo {
      font-size: 1.2rem;
      font-weight: bold;
    }

    nav ul {
      list-style: none;
      display: flex;
      gap: 20px;
      margin: 0;
      padding: 0;
    }

    nav ul li {
      display: inline;
    }

    nav ul li a {
      color: white;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s;
    }

    nav ul li a:hover {
      color: #ffdd57;
    }

    /* MOBILE NAV */
    @media (max-width: 768px) {
      nav ul {
        flex-direction: column;
        position: absolute;
        top: 60px;
        right: 0;
        background: #007bff;
        width: 200px;
        display: none;
        padding: 10px;
        border-radius: 0 0 8px 8px;
      }
      nav ul.show {
        display: flex;
      }
      .menu-toggle {
        display: block;
        cursor: pointer;
        font-size: 1.5rem;
      }
    }

    @media (min-width: 769px) {
      .menu-toggle {
        display: none;
      }
    }

    h1 {
      text-align: center;
      color: #444;
    }

    /* ====== TABLEAU (PC) ====== */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 12px 15px;
      border-bottom: 1px solid #eee;
      text-align: left;
    }
    th {
      background: #007bff;
      color: white;
      text-transform: uppercase;
      font-size: 14px;
    }
    tr:hover {
      background: #f1f1f1;
    }

    /* ====== CARTES (MOBILE) ====== */
    .order-card {
      display: none;
      background: white;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .order-card h3 {
      margin: 0 0 10px 0;
      color: #007bff;
    }
    .order-card p {
      margin: 5px 0;
    }
    .order-card .actions {
      margin-top: 10px;
      display: flex;
      gap: 10px;
    }
    .order-card a {
      color: #007bff;
      text-decoration: none;
      font-weight: bold;
    }
    .order-card a:hover {
      text-decoration: underline;
    }
    .delete-btn {
      color: red;
      font-weight: bold;
      cursor: pointer;
      background: none;
      border: none;
    }
    .delete-btn:hover {
      text-decoration: underline;
    }

    /* ====== RESPONSIVE ====== */
    @media (max-width: 768px) {
      table { display: none; }
      .order-card { display: block; }
    }
  </style>
   <script>
    // Toggle menu mobile
    function toggleMenu() {
      document.getElementById("menu").classList.toggle("show");
    }
  </script>
</head>
<body>
     <nav>
<a href="Accueil.html" style="display: inline-flex; align-items: center; text-decoration: none; font-weight: bold; font-size: 1.6rem; gap: 10px;">
  <img src="cromali.png" alt="Cro-Mali" style="width: 50px; height: auto;" />
  <span>
    <span style="color: #006400; letter-spacing: 2px;">CRO</span>
    <span style="color: #32CD32; letter-spacing: 2px;">MALI</span>
  </span>
</a>
        <div class="menu-toggle" onclick="toggleMenu()">‚ò∞</div>
    <ul id="menu">
      <li><a href="AdminServices.html">Services</a></li>
      <li><a href="Adminproduits.html">Produits</a></li>
      <li><a href="Admincommandes.html">Commandes</a></li>
      <li><a href="pagedadministration.html">Administration</a></li>
    </ul>
  </nav>
  <h1>üì¶ Liste des Commandes</h1>

  <!-- TABLEAU (PC) -->
  <table id="ordersTable">
    <thead>
      <tr>
        <th>Nom</th>
        <th>Email</th>
        <th>T√©l√©phone</th>
        <th>Produit</th>
        <th>Cat√©gorie</th>
        <th>Sous-cat√©gorie</th>
        <th>Prix (Fcfa)</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- CARTES (MOBILE) -->
  <div id="ordersCards"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getFirestore, collection, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDs-3TYY-ituu4GqtBbPdFzcH6XYkdEB3o",
      authDomain: "maintenanceinformatique-d9b17.firebaseapp.com",
      projectId: "maintenanceinformatique-d9b17",
      storageBucket: "maintenanceinformatique-d9b17.firebasestorage.app",
      messagingSenderId: "271885214932",
      appId: "1:271885214932:web:e26b80eb6ff3dce0228741"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function loadOrders() {
      const ordersTableBody = document.querySelector("#ordersTable tbody");
      const ordersCards = document.querySelector("#ordersCards");
      ordersTableBody.innerHTML = "";
      ordersCards.innerHTML = "";

      try {
        const querySnapshot = await getDocs(collection(db, "commandes"));
        querySnapshot.forEach((docSnap) => {
          const order = docSnap.data();
          const orderId = docSnap.id;

          // Nettoyage du num√©ro pour WhatsApp
          let cleanPhone = order.phone.replace(/\D/g, "");
          if (cleanPhone.startsWith("0")) {
            cleanPhone = "223" + cleanPhone.slice(1); // Exemple Mali
          }

          /* === TABLEAU (PC) === */
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${order.name} ${order.surname}</td>
            <td><a href="mailto:${order.email}">${order.email}</a></td>
            <td>
              <div class="actions">
                <a href="tel:${order.phone}">üìû Appeler</a>
                <a href="https://wa.me/${cleanPhone}" target="_blank">üí¨ WhatsApp</a>
              </div>
            </td>
            <td>${order.productName}</td>
            <td>${order.productCategory}</td>
            <td>${order.productSubcategory}</td>
            <td>${order.productPrice} FCFA</td>
            <td><button class="delete-btn" onclick="deleteOrder('${orderId}')">üóëÔ∏è Supprimer</button></td>
          `;
          ordersTableBody.appendChild(row);

          /* === CARTE (MOBILE) === */
          const card = document.createElement("div");
          card.className = "order-card";
          card.innerHTML = `
            <h3>${order.productName} - ${order.productPrice} FCFA</h3>
            <p><strong>Nom :</strong> ${order.name} ${order.surname}</p>
            <p><strong>Email :</strong> <a href="mailto:${order.email}">${order.email}</a></p>
            <p><strong>T√©l√©phone :</strong> ${order.phone}</p>
            <p><strong>Cat√©gorie :</strong> ${order.productCategory}</p>
            <p><strong>Sous-cat√©gorie :</strong> ${order.productSubcategory}</p>
            <div class="actions">
              <a href="tel:${order.phone}">üìû Appeler</a>
              <a href="https://wa.me/${cleanPhone}" target="_blank">üí¨ WhatsApp</a>
              <button class="delete-btn" onclick="deleteOrder('${orderId}')">üóëÔ∏è Supprimer</button>
            </div>
          `;
          ordersCards.appendChild(card);
        });
      } catch (error) {
        console.error("Erreur lors du chargement des commandes :", error);
        alert("Impossible de charger les commandes !");
      }
    }

    // Suppression commande
    window.deleteOrder = async function(orderId) {
      if (confirm("Voulez-vous vraiment supprimer cette commande ?")) {
        try {
          await deleteDoc(doc(db, "commandes", orderId));
          alert("Commande supprim√©e avec succ√®s !");
          loadOrders(); // recharger la liste
        } catch (error) {
          console.error("Erreur suppression commande :", error);
          alert("Erreur lors de la suppression.");
        }
      }
    }

    loadOrders();
  </script>
</body>
</html>
